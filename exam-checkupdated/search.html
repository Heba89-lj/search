<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„ÙØ­Øµ</title>
  <style>
    body { font-family: "Cairo", sans-serif; text-align: center; margin-top: 50px; }
    input { padding: 8px; margin: 5px; }
    button { padding: 10px 20px; cursor: pointer; }
  </style>
</head>
<body>
  <h1>Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø± Ø¹Ù† Ø§Ù„ÙØ­Øµ</h1>
  <input id="number" placeholder="Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ">
  <input id="year" placeholder="Ø§Ù„Ø³Ù†Ø©">
  <button id="searchBtn">Ø¨Ø­Ø«</button>
  <div id="result" style="margin-top:20px; font-weight:bold;"></div>

   <script>
document.getElementById('searchBtn').addEventListener('click', async () => {
  const number = document.getElementById('number').value.trim();
  const year = document.getElementById('year').value.trim();
  const resultDiv = document.getElementById('result');

  resultDiv.innerHTML = ""; // Ù…Ø³Ø­ Ø£ÙŠ Ù†ØªÙŠØ¬Ø© Ø³Ø§Ø¨Ù‚Ø©

  if (!number || !year) {
    resultDiv.textContent = 'Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ ÙˆØ§Ù„Ø³Ù†Ø©.';   
    return;
  }

  resultDiv.textContent = 'Ø¬Ø§Ø±Ù Ø§Ù„Ø¨Ø­Ø«...';

  try {
    // âœ… Ø£Ù‡Ù… ØªØ¹Ø¯ÙŠÙ„: Ù…Ø³Ø§Ø± fetch Ù…Ø¶Ø¨ÙˆØ· Ø¹Ù„Ù‰ Vercel
    const res = await fetch(`/api/search?number=${encodeURIComponent(number)}&year=${encodeURIComponent(year)}`);
    // const data = await res.json();

    // if (!res.ok) {
    //   resultDiv.textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.';
    //   return;
    // }


    let data;
try {
  data = await res.json();
} catch (jsonError) {
  const text = await res.text();
  console.error('ğŸ”´ Ø§Ù„Ø±Ø¯ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±:', text);
  resultDiv.textContent = `Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ø³ÙŠØ±ÙØ±:\n${text}`;
  return;
}

if (!res.ok) {
  resultDiv.textContent = data.message || 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø¨Ø­Ø«.';
  return;
}

    if (data.success) {
      const r = data.result || {};

      // Ø£Ù†Ø´Ø¦ Ø¬Ø¯ÙˆÙ„ Ù„Ø¹Ø±Ø¶ ÙƒÙ„ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„Ø³Ø¨Ø¹Ø©
      resultDiv.innerHTML = `
        <table style="margin:0 auto; text-align:right; border-collapse: collapse;">
          <tr><th style="padding:6px 12px;">Ø±Ù‚Ù… Ø§Ù„ÙØ­Øµ</th><td>${r.number || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ø§Ù„Ø³Ù†Ø©</th><td>${r.year || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ø±Ù‚Ù… Ø§Ù„Ù‚Ø¶ÙŠØ©</th><td>${r.caseNumber || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ø§Ø³Ù… Ù…Ù‚Ø¯Ù… Ø§Ù„Ø·Ù„Ø¨</th><td>${r.applicant || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨</th><td>${r.status || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ø§Ù„ØªØ£Ø´ÙŠØ±Ø§Øª</th><td>${r.visa || "-"}</td></tr>
          <tr><th style="padding:6px 12px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th><td>${r.notes || "-"}</td></tr>
        </table>
      `;
    } else {
      resultDiv.textContent = data.message || 'Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù‡Ø°Ø§ Ø§Ù„ÙØ­Øµ.';
    }
  } catch (err) {
    console.error(err);
    resultDiv.textContent = 'Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙ‰ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³ÙŠØ±ÙØ±';
  }
});
</script>

</body>
</html>



